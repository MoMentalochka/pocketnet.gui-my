!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.libraryStarter=t():e.libraryStarter=t()}(this,(()=>(()=>{"use strict";var e={326:(e,t,i)=>{i.d(t,{Z:()=>s});var n=i(81),o=i.n(n),r=i(645),a=i.n(r)()(o());a.push([e.id,'#bc-root.full{position:fixed !important;z-index:300000;width:100vw;height:100vh;top:0}#bc-root.full #bc-format i::before{content:""}#bc-root.middle{position:fixed !important;z-index:300000;width:100vw;height:100vh;top:0}#bc-root.middle .bc-format{display:none}@media screen and (min-width: 1280px){#bc-root.middle{z-index:300000;width:70vw;height:80vh;top:10vh}#bc-root.middle .bc-topnav{width:70vw}#bc-root.middle .bc-topnav .bc-format{display:initial}#bc-root.middle .bc-video-container{width:70vw;height:80vh;position:relative}#bc-root.middle .bc-video-container .active video{max-width:70vw;max-height:80vh}#bc-root.middle .bc-video-container .minified{position:absolute}#bc-root.middle .bc-controls{max-width:70vw;bottom:10vh;padding:2% 0}}#bc-root.middle #bc-format i::before{content:""}#bc-root.minified{position:fixed;width:auto;height:auto;top:initial;right:initial;bottom:20px;left:20px;border:1px solid rgba(0,0,0,0);border-radius:30px;overflow:hidden;cursor:pointer}#bc-root.minified .bc-topnav{opacity:0}#bc-root.minified .bc-topnav .bc-call-info{max-width:100%}#bc-root.minified .bc-topnav .options{display:none}#bc-root.minified .bc-video-container{width:auto;height:auto;max-height:initial !important;padding-bottom:0;transition:all .3s ease}#bc-root.minified .bc-video-container.vertical{max-width:250px}#bc-root.minified .bc-video-container.vertical .active{max-width:250px}#bc-root.minified .bc-video.minified{display:none}#bc-root.minified .bc-video.active{transition:all .3s ease;height:100%;max-width:350px}#bc-root.minified .bc-video.active.novid{max-height:250px;padding:1em;max-width:250px;max-height:250px}#bc-root.minified .bc-video.active video{width:auto}@media screen and (max-width: 768px){#bc-root.minified .bc-video .name{display:none}}#bc-root.minified .bc-video-btn{display:none}#bc-root.minified .bc-controls{position:absolute;bottom:0;min-width:initial !important;justify-content:space-between;opacity:0;transition:opacity .3s ease}@media screen and (max-width: 1025px){#bc-root.minified .bc-controls{display:none !important}}#bc-root.minified .bc-controls .bc-btn{width:4vw;height:4vw;max-width:55px;max-height:55px;font-size:.8rem;margin:0}#bc-root.minified .bc-controls .bc-btn.bc-camera,#bc-root.minified .bc-controls .bc-btn.bc-decline,#bc-root.minified .bc-controls .bc-btn.bc-hide{display:none}#bc-root.minified .bc-controls .bc-btn#bc-expand{display:flex}#bc-root.minified:hover .bc-controls,#bc-root.minified:hover .bc-topnav{display:flex;opacity:1}@media screen and (max-width: 1025px){#bc-root.minified{top:65px !important;right:10px !important;left:initial !important;bottom:initial !important;border-radius:15px;overflow:hidden}#bc-root.minified .bc-video-container{max-width:250px}#bc-root.minified .bc-video-container.vertical{max-width:25vw}#bc-root.minified .bc-topnav{display:none !important}}.bc{-webkit-tap-highlight-color:rgba(0,0,0,0) !important}.bc-container{font-family:"Segoe UI Variable","Segoe UI",SegoeUI,"Helvetica Neue",Helvetica,Arial,sans-serif;display:flex;flex-wrap:wrap;justify-content:space-evenly;align-items:center}.bc-container>div{z-index:333333}.bc-notify{z-index:4444444 !important;position:fixed;top:28px}.bc-incoming-call{z-index:33333;padding:10px;width:494px;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;background:radial-gradient(87.44% 183.75% at 50% 50%, rgba(0, 0, 0, 0) 0%, #000000 100%),#242f3d;box-shadow:0px 4px 20px rgba(0,0,0,.5);border-radius:12px}@media screen and (max-width: 576px){.bc-incoming-call{padding:16px;width:90vw}}.bc-incoming-call .user{display:flex;justify-content:space-between;max-width:50%}@media screen and (max-width: 576px){.bc-incoming-call .user{max-width:70%;margin-bottom:16px}}.bc-incoming-call .user .title{text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;line-height:20px;color:rgb(var(--color-cc-white))}.bc-incoming-call .user .title .name{font-size:16px;text-align:left;color:rgb(var(--text-on-bg-ac-color));width:200px;overflow:hidden;text-overflow:ellipsis}.bc-incoming-call .user .title .description{color:rgb(var(--neutral-grad-2));font-size:14px;text-align:left}.bc-incoming-call .user .avatar{margin-right:16px;border:2px solid rgba(0,0,0,0);width:44px;height:44px;border-radius:50%;overflow:hidden;display:flex;justify-content:center;align-items:center;font-size:1.4em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-incoming-call .user .avatar img{height:100%;width:100%}.bc-incoming-call .buttons{display:flex;justify-content:space-between}@media screen and (max-width: 576px){.bc-incoming-call .buttons{width:100%;justify-content:space-between}.bc-incoming-call .buttons .bc-btn{width:48% !important;margin:0}}.bc-incoming-call .buttons .bc-btn{width:56px;height:48px;border-radius:12px;margin:0 10px;border:none;cursor:pointer}.bc-incoming-call .buttons .bc-answer{background:linear-gradient(90deg, #495AFF 0%, #0ACFFE 100%),#00a4ff}.bc-incoming-call .buttons .bc-answer i{transform:rotate(90deg)}.bc-incoming-call .buttons .bc-decline{background:linear-gradient(90deg, #EB3349 2.65%, #F45C43 100.53%),#eb5757}.bc-incoming-call .buttons .bc-decline i{transform:rotate(225deg)}.bc-incoming-call .buttons i{color:rgb(var(--text-on-bg-ac-color))}.bc-ended-call{width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;background:radial-gradient(87.44% 183.75% at 50% 50%, rgba(0, 0, 0, 0) 0%, #000000 100%),#242f3d;color:rgb(var(--text-on-bg-ac-color))}.bc-ended-call .avatar{display:flex;border:2px solid rgba(var(--background-hidden-layer, 0.1));width:160px;height:160px;border-radius:50%;overflow:hidden;justify-content:center;align-items:center;font-size:1.6em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-ended-call .avatar img{width:100%;height:100%}.bc-ended-call .name{font-size:28px;font-weight:600;margin-top:42px;width:400px;text-align:center;max-width:90vw;overflow:hidden;text-overflow:ellipsis}.bc-ended-call .description{color:#838383;font-size:16px;line-height:24px;margin-top:4px}.bc-ended-call button{cursor:pointer}.bc-video{position:relative;display:flex;justify-content:center}@media screen and (orientation: portrait){.bc-video{max-width:100%}}.bc-video-container{display:flex;justify-content:center;flex-wrap:wrap;align-items:center;width:100vw;height:100vh;background:radial-gradient(55.29% 79.17% at 50% 47.76%, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.88) 100%),#242f3d;box-shadow:0px 32px 64px rgba(0,0,0,.56),0px 2px 21px rgba(0,0,0,.55)}@media screen and (orientation: portrait){.bc-video{justify-content:center}}.bc-video .name{position:absolute;bottom:0;left:0;text-align:center;font-size:12px;height:12px;line-height:12px;min-width:60px;background-color:rgba(255,255,255,.4)}.bc-video video{max-height:100%;width:100%}@media screen and (orientation: portrait){.bc-video video{max-height:40vh}}.bc-video.active{width:100%;margin:0 auto;height:100vh;max-height:100vh}.bc-video.active .avatar{border:2px solid rgba(var(--background-hidden-layer, 0.1));width:160px;height:160px;border-radius:50%;overflow:hidden;display:none;justify-content:center;align-items:center;font-size:1.6em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-video.active .avatar img{width:100%;height:100%}.bc-video.active video{max-height:100vh;max-width:100vw;width:auto !important}.bc-video.active.novid{max-height:100%;align-items:center}.bc-video.active.novid .avatar{display:flex}.bc-video.active.novid video{display:none}.bc-video.minified{margin:0;border-radius:10%;z-index:33333333;position:fixed;right:30px;bottom:15%;max-width:15vw;overflow:hidden}.bc-video.minified video{transform:scale(-1, 1);height:15vw;width:auto}@media screen and (orientation: portrait){.bc-video.minified{max-width:15vh}.bc-video.minified video{height:15vh;width:auto}}.bc-controls{display:flex;justify-content:center;position:fixed;background:linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.99466) 99.44%);bottom:0;width:100%;padding:5%;min-width:280px !important;max-width:100vw}.bc-controls .bc-btn{margin:0 20px;background:rgba(var(--neutral-grad-2, 0.4));text-align:center;font-size:1em;font-weight:600;border-radius:50%;width:55px;height:55px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:none}.bc-controls .bc-btn.active{background:rgb(var(--text-on-bg-ac-color))}.bc-controls .bc-btn.active i{color:rgb(var(--text-color))}@media screen and (max-width: 768px){.bc-controls .bc-btn{margin:0 10px;width:45px;height:45px}}.bc-controls .bc-btn i{pointer-events:none;color:rgb(var(--text-on-bg-ac-color))}.bc-controls .bc-btn.bc-decline{background:rgb(var(--color-bad));border:1px solid rgba(0,0,0,0);transform:rotate(225deg)}.bc-controls .bc-btn#bc-expand{display:none}.bc-topnav{z-index:4444444 !important;display:flex;justify-content:space-between;align-items:center;position:absolute;top:0;right:0;left:0;color:rgb(var(--text-on-bg-ac-color));background:linear-gradient(180deg, rgba(0, 0, 0, 0.799466) 0%, rgba(0, 0, 0, 0) 99.44%);padding:26px 28px;width:100vw}.bc-topnav .options button{background:rgba(0,0,0,0);border:none;cursor:pointer}.bc-topnav .options button i{color:rgb(var(--text-on-bg-ac-color))}.bc-call-info{display:flex;flex-direction:column}.bc-call-info .name{width:200px;overflow:hidden;text-overflow:ellipsis;transition:width .3s ease}@media(pointer: fine){.bc-call-info .name:hover{width:400px}}',""]);const s=a},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",n=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),n&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),n&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,n,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(n)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);n&&a[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),i&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=i):d[2]=i),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),t.push(d))}},t}},81:e=>{e.exports=function(e){return e[1]}},187:e=>{var t,i="object"==typeof Reflect?Reflect:null,n=i&&"function"==typeof i.apply?i.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};t=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(i,n){function o(i){e.removeListener(t,r),n(i)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",o),i([].slice.call(arguments))}f(e,t,r,{once:!0}),"error"!==t&&function(e,t,i){"function"==typeof e.on&&f(e,"error",t,{once:!0})}(e,o)}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function l(e,t,i,n){var o,r,a,l;if(s(i),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),r=e._events),a=r[t]),void 0===a)a=r[t]=i,++e._eventsCount;else if("function"==typeof a?a=r[t]=n?[i,a]:[a,i]:n?a.unshift(i):a.push(i),(o=c(e))>0&&a.length>o&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,l=d,console&&console.warn&&console.warn(l)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},o=d.bind(n);return o.listener=i,n.wrapFn=o,o}function v(e,t,i){var n=e._events;if(void 0===n)return[];var o=n[t];return void 0===o?[]:"function"==typeof o?i?[o.listener||o]:[o]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(o):p(o,o.length)}function m(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function f(e,t,i,n){if("function"==typeof e.on)n.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(r){n.once&&e.removeEventListener(t,o),i(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var o="error"===e,r=this._events;if(void 0!==r)o=o&&void 0===r.error;else if(!o)return!1;if(o){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var l=c.length,d=p(c,l);for(i=0;i<l;++i)n(d[i],this,t)}return!0},r.prototype.addListener=function(e,t){return l(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return l(this,e,t,!0)},r.prototype.once=function(e,t){return s(t),this.on(e,h(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,h(this,e,t)),this},r.prototype.removeListener=function(e,t){var i,n,o,r,a;if(s(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(o=-1,r=i.length-1;r>=0;r--)if(i[r]===t||i[r].listener===t){a=i[r].listener,o=r;break}if(o<0)return this;0===o?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,o),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var o,r=Object.keys(i);for(n=0;n<r.length;++n)"removeListener"!==(o=r[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},r.prototype.listeners=function(e){return v(this,e,!0)},r.prototype.rawListeners=function(e){return v(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},r.prototype.listenerCount=m,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},379:e=>{var t=[];function i(e){for(var i=-1,n=0;n<t.length;n++)if(t[n].identifier===e){i=n;break}return i}function n(e,n){for(var r={},a=[],s=0;s<e.length;s++){var c=e[s],l=n.base?c[0]+n.base:c[0],d=r[l]||0,h="".concat(l," ").concat(d);r[l]=d+1;var v=i(h),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==v)t[v].references++,t[v].updater(m);else{var p=o(m,n);n.byIndex=s,t.splice(s,0,{identifier:h,updater:p,references:1})}a.push(h)}return a}function o(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,o){var r=n(e=e||[],o=o||{});return function(e){e=e||[];for(var a=0;a<r.length;a++){var s=i(r[a]);t[s].references--}for(var c=n(e,o),l=0;l<r.length;l++){var d=i(r[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=c}}},569:e=>{var t={};e.exports=function(e,i){var n=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,i)=>{e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var o=void 0!==i.layer;o&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,o&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var r=i.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={id:n,exports:{}};return e[n](r,r.exports,i),r.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nc=void 0;var n={};return(()=>{i.r(n),i.d(n,{default:()=>g});var e=i(187),t=i(379),o=i.n(t),r=i(795),a=i.n(r),s=i(569),c=i.n(s),l=i(565),d=i.n(l),h=i(216),v=i.n(h),m=i(589),p=i.n(m),f=i(326),b={};b.styleTagTransform=p(),b.setAttributes=d(),b.insert=c().bind(null,"head"),b.domAPI=a(),b.insertStyleElement=v(),o()(f.Z,b),f.Z&&f.Z.locals&&f.Z.locals;class u extends e.EventEmitter{constructor(e,t,i,n){super(),this.client=e,this.matrixcs=t,this.initEvents(),this.initTemplates(i),this.options=n}controls={};isFrontalCamera=!1;videoStreams=null;isMuted=!1;activeCall=null;secondCall=null;syncInterval=null;isWaitingForConnect=!1;templates={incomingCall:function(){return`\n\t\t\t<div class="bc-incoming-call">\n\t\t\t\t<div class="user">\n\t\t\t\t\t<div class="avatar">\n\t\t\t\t\t\t${this.getAvatar()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="title">\n\t\t\t\t\t\t<div class="name">${this.activeCall.initiator.source.name}</div>\n\t\t\t\t\t\t<div class="description">Входящий звонок</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="buttons">\n\t\t\t\t\t<button class="bc-btn bc-decline" id="bc-decline"><i class="fas fa-phone"></i></button>\n\t\t\t\t\t<button class="bc-btn bc-answer" id="bc-answer"><i class="fas fa-phone"></i></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`},endedCall:function(e){return`\t\n\t\t\t<div class="bc-ended-call">\n\t\t\t\t<div class="avatar">\n\t\t\t\t\t\t${this.getAvatar()}\n\t\t\t\t</div>\n\t\t\t\t<div class="name">${this.activeCall.initiator.source.name}</div>\n\t\t\t\t<div class="description">Звонок завершен</div>\n\t\t\t</div>`},videoCall:function(){return`\n\t\t\t<div class="bc-topnav">\n\t\t\t\t<div class="bc-call-info">\n\t\t\t\t\t<div class="time" id="time">12:02</div>\n\t\t\t\t\t<div class="name">${this.activeCall.initiator.source.name}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="options">\n\t\t\t\t\t<button class="bc-btn bc-cog" id="bc-cog"><i class="fas fa-cog"></i></button>\n\t\t\t\t\t<button class="bc-btn bc-pip" id="bc-pip"><i class="fas fa-images"></i></button>\n\t\t\t\t\t<button class="bc-btn bc-format" id="bc-format"><i class="fas"></i></button>\n\t\t\t\t</div>\t\n\t\t\t</div>\n\t\t\t<div class="bc-video-container">\n\t\t\t\t<div class="bc-video active novid" id="remote-scene">\n\t\t\t\t\t<video id="remote" pip="false" autoplay playsinline ></video>\n\t\t\t\t\t<div class="avatar">${this.getAvatar()}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bc-video minified">\n\t\t\t\t\t<video id="local" pip="false" autoplay playsinline ></video>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bc-controls">\n\t\t\t\t<button class="bc-btn bc-camera" id="bc-camera"><i class="fas fa-sync-alt"></i></button>\n\t\t\t\t<button class="bc-btn bc-hide" id="bc-hide"><i class="fas fa-video"></i></button>\n\t\t\t\t<button class="bc-btn bc-mute" id="bc-mute"><i class="fas fa-microphone"></i></button>\n\t\t\t\t<button class="bc-btn bc-decline" id="bc-decline"><i class="fas fa-phone"></i></button>\n\t\t\t\t<button class="bc-btn bc-expand" id="bc-expand"><i class="fas fa-expand"></i></button>\n\t\t\t</div>\n\t\t`}};renderTemplates={videoCall:()=>{console.log("videoCall"),this.root.classList.add("middle"),this.root.innerHTML=this.templates.videoCall?.call(this)||"",this.initCallInterface("videoCall")},incomingCall:e=>{this.root.classList.remove("middle"),this.notify.innerHTML=this.templates.incomingCall?.call(this)||"",this.initCallInterface("incomingCall",e)},clearNotify:()=>{console.log("clearNotify"),this.notify.innerHTML=""},clearVideo:()=>{console.log("clearVideo"),this.root.innerHTML=""},clearInterface:()=>{console.log("clearInterface"),this.root.classList.remove("active"),this.root.classList.remove("minified"),this.root.classList.remove("middle"),this.root.classList.remove("full")},endedCall:e=>{this.root.classList.contains("minified")&&(this.root.classList.remove("minified"),this.root.classList.add("middle")),this.root.innerHTML=this.templates.endedCall?.call(this,e)||""}};initTemplates(e){console.log(e),e.insertAdjacentHTML("beforeend",'<div class="bc-container"><div id="bc-notify" class="bc-notify"></div><div id="bc-root"></div></div>'),this.root=document.getElementById("bc-root"),this.notify=document.getElementById("bc-notify"),window&&(console.log("проверка закрывашки"),window.onunload=()=>{this.activeCall&&this.activeCall.hangup()})}initEvents(){this.client.on("Call.incoming",(async e=>{let t=this.client.store.rooms[e.roomId].currentState.members,i=t[Object.keys(t).filter((e=>e!==this.client.credentials.userId))],n=t[this.client.credentials.userId];e.initiator=i,e.user=n,console.log("перед",i),this.options.getUserInfo(i.userId).then((t=>{console.log("res",t),i.source=t[0]||t,this.addCallListeners(e),this.activeCall?this.secondCall?e.reject("занято"):(this.secondCall=e,console.log("новый звонок в очереди",e)):this.activeCall=e,this.renderTemplates.incomingCall(e)}))}))}answer(){try{"ringing"===this.activeCall.state?(this.activeCall.answer(),console.log("Ответ на",this.activeCall),this.renderTemplates.clearNotify(),this.renderTemplates.videoCall()):(this.isWaitingForConnect=!0,this.renderTemplates.clearNotify(),this.activeCall.hangup(),setTimeout((()=>{try{console.log("Сброс + ответ на",this.activeCall),this.activeCall.answer(),this.isWaitingForConnect=!1,this.renderTemplates.videoCall()}catch(e){console.log("Ошибка при ответе на вторую линию",e)}}),1e3))}catch(e){console.log("error answer",e)}}initsync(){let e=document.querySelector(".bc-video-container");this.syncInterval=setInterval(function(){if(console.log(this),this?.activeCall?.remoteStream){let t=this?.activeCall?.remoteStream.getVideoTracks()[0];if(this.root.classList.contains("minified")){let i=t.getSettings().aspectRatio;i&&(e.style.aspectRatio=i,i<1?e.classList.add("vertical"):e.classList.remove("vertical"))}}}.bind(this),1e3)}mute(e){e.stopPropagation();let t=this.activeCall.peerConn.getSenders().find((e=>"audio"===e.track.kind)),i=document.querySelector(".bc-mute");t.track.enabled?(i.firstChild.classList.remove("fa-microphone"),i.classList.add("active"),i.firstChild.classList.add("fa-microphone-slash")):(i.firstChild.classList.remove("fa-microphone-slash"),i.classList.remove("active"),i.firstChild.classList.add("fa-microphone")),t.track.enabled=!t.track.enabled,console.log("mute",this.activeCall.peerConn.getSenders())}hide(e){e.stopPropagation();let t=this.activeCall.peerConn.getSenders().find((e=>"video"===e.track?.kind||!e.track)),i=document.querySelector(".bc-hide");t.track.enabled?(i.firstChild.classList.remove("fa-video"),i.classList.add("active"),i.firstChild.classList.add("fa-video-slash")):(i.firstChild.classList.remove("fa-video-slash"),i.classList.remove("active"),i.firstChild.classList.add("fa-video")),t.track.enabled=!t.track.enabled,console.log("hide",this.activeCall.peerConn.getSenders(),this.activeCall.peerConn.getReceivers()),console.log("remote tracks",this.activeCall.remoteStream.getTracks())}cameraCount(){navigator.mediaDevices.enumerateDevices().then((e=>{let t=e.filter((e=>"videoinput"===e.kind));console.log(t),t.length<=1&&(document.getElementById("bc-camera").style.display="none",console.log("no cameras"))}))}camera(e){let t=this;try{navigator.mediaDevices.enumerateDevices().then((e=>{let i,n=e.filter((e=>"videoinput"===e.kind));const o=t.activeCall.peerConn.getSenders();console.log("senders",o);let r=o.find((e=>"video"==e.track.kind));if(console.log("sender",r),r&&r?.label?.includes("front")&&(console.log("Используется фронтальная камера"),t.isFrontalCamera=!0),console.log("список видео",n),!(n.length>1))return;r.track.label.includes("front")||r.track.label.includes("передней")?(console.log("на заднюю"),i=n.reverse().find((e=>e.label.includes("back")||e.label.includes("задней")))):(console.log("на переднюю"),i=n.find((e=>e.label.includes("front")||e.label.includes("передней")))),console.log("fft",i);let a={};a.deviceId={exact:i.deviceId};const s={video:a,audio:!1};navigator.mediaDevices.getUserMedia(s).then((e=>{e.getTracks().forEach((function(i){console.log("track",i);const n=t.activeCall.peerConn.getSenders().find((e=>e.track.kind==i.kind));console.log("текущий видеострим ",n),n.track.label!==i.label?(i.muted&&console.log("Трек не доступен",i),n.replaceTrack(i),t.videoStreams.local.srcObject=e):console.log("одинаковый стрим")})),this.hide()})).catch((function(e){console.log("Const stream: "+e.message)}))})).catch((function(e){console.log("Check: "+e.message)}))}catch(e){console.log("sa",e)}}format(){this.root.classList.contains("middle")?(this.root.classList.remove("middle"),this.root.classList.add("full")):this.root.classList.contains("full")&&(this.root.classList.remove("full"),this.root.classList.add("middle"))}pip(){this.root.classList.contains("middle")?(this.root.classList.remove("middle"),this.root.classList.add("minified")):this.root.classList.contains("full")?(this.root.classList.remove("full"),this.root.classList.add("minified")):(clearInterval(this.syncInterval),console.log("interval",this.syncInterval),this.root.classList.remove("minified"),this.root.classList.add("middle"))}async initCall(e){console.log("init call");try{const e={video:!0};await navigator.mediaDevices.getUserMedia(e),console.log("media checked")}catch(e){console.log("media error",e)}const t=matrixcs.createNewMatrixCall(this.client,e);if(this.activeCall)return void console.log("You have active call");this.activeCall=t,t.placeVideoCall(document.getElementById("remote"),document.getElementById("local"));let i=this.client.store.rooms[t.roomId].currentState.members,n=i[Object.keys(i).filter((e=>e!==this.client.credentials.userId))],o=i[this.client.credentials.userId];return t.initiator=n,t.user=o,n.source=await this.options.getUserInfo(n.userId)[0],console.log(n),this.options.getUserInfo(n.userId).then((e=>{console.log(e),n.source=e[0]||e,this.addCallListeners(t),this.renderTemplates.videoCall()})).catch((e=>console.log("get user info error",e))),t}hexDecode(e){for(var t=0,i="",n=2;n<=e.length;n+=2)(t=parseInt(e.substring(n-2,n),16))>=128&&(t+=848),i+=t=String.fromCharCode("0x"+t.toString(16));return i}hangup(e){e.stopPropagation(),this.activeCall.hangup("ended",!1),this.renderTemplates.clearVideo(),console.log("hangup")}reject(e){e.reject()}initCallInterface(e,t){switch(e){case"incomingCall":document.getElementById("bc-answer").addEventListener("click",this.answer.bind(this)),document.getElementById("bc-decline").addEventListener("click",(()=>this.reject(t)));break;case"videoCall":this.videoStreams={remote:document.getElementById("remote"),local:document.getElementById("local")};try{console.log("init call interface",this.activeCall),this.activeCall.setLocalVideoElement(this.videoStreams.local),this.activeCall.setRemoteVideoElement(this.videoStreams.remote),this.cameraCount(),this.addVideoInterfaceListeners(),console.log("стримы",this.videoStreams)}catch(e){console.log("init interface error",e)}}}addVideoInterfaceListeners(){document.getElementById("remote-scene").addEventListener("click",(e=>this.pip.call(this,e))),document.getElementById("bc-decline").addEventListener("click",(e=>this.hangup.call(this,e))),document.getElementById("bc-mute").addEventListener("click",(e=>this.mute.call(this,e))),document.getElementById("bc-hide").addEventListener("click",(e=>this.hide.call(this,e))),document.getElementById("bc-camera").addEventListener("click",(e=>this.camera.call(this,e))),document.getElementById("bc-expand").addEventListener("click",(e=>this.pip.call(this,e))),document.getElementById("bc-cog").addEventListener("click",(e=>this.settings.call(this,e))),document.getElementById("bc-format").addEventListener("click",(e=>this.format.call(this,e))),document.getElementById("bc-pip").addEventListener("click",(e=>this.pip.call(this,e)))}addCallListeners(e){e.on("state",((e,t)=>{console.log("state",e),"connected"===e&&(this.showRemoteVideo(),console.log("connected",this.activeCall),this.initsync()),"ended"===e&&(clearInterval(this.syncInterval),console.log("interval",this.syncInterval))})),e.on("hangup",(e=>{if(clearInterval(this.syncInterval),console.log("interval",this.syncInterval),console.log("Call ended",this),e||this.renderTemplates.clearNotify(),e.callId===this.secondCall?.callId&&(this.secondCall=null,this.renderTemplates.clearNotify(),console.log("second line ended",e)),e.callId===this.activeCall?.callId){if(console.log("first line ended",e),this.isWaitingForConnect)return this.activeCall=this.secondCall,this.secondCall=null,void console.log("вторая линия стала первой",this.activeCall);if(this.renderTemplates.clearVideo(),this.renderTemplates.clearNotify(),"local"===e.hangupParty||e.localVideoElement)return this.root.classList.contains("minified")||!this.root.classList.length?(this.renderTemplates.clearVideo(),this.renderTemplates.clearInterface(),void(this.activeCall=null)):(this.renderTemplates.endedCall(e),void setTimeout((()=>{this.renderTemplates.clearVideo(),this.renderTemplates.clearInterface(),this.activeCall=null}),2e3));this.renderTemplates.clearInterface()}})),e.on("error",(function(t){this.renderTemplates.clearVideo(),console.log("some error",t),this.lastError=t.message,e.hangup("error"),this.emit("error",t)}))}getAvatar(){return this.activeCall.initiator?.source?.image?`<img src="${this.activeCall.initiator.source.image}"/>`:this.activeCall.initiator.source.name[0].toUpperCase()}showRemoteVideo(){document.getElementById("remote-scene").classList.remove("novid")}}window.BastyonCalls=u;const g=u})(),n})()));