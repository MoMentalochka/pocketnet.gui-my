!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.libraryStarter=e():t.libraryStarter=e()}(this,(()=>(()=>{"use strict";var t={326:(t,e,i)=>{i.d(e,{Z:()=>s});var n=i(81),o=i.n(n),r=i(645),a=i.n(r)()(o());a.push([t.id,'#bc-root.full{position:fixed !important;z-index:300000;width:100vw;height:100vh;top:0}#bc-root.full #bc-format i::before{content:""}#bc-root.middle{position:fixed !important;z-index:300000;width:100vw;height:100vh;top:0}#bc-root.middle .bc-format{display:none}@media screen and (min-width: 1280px){#bc-root.middle{z-index:300000;width:70vw;height:80vh;top:10vh}#bc-root.middle .bc-topnav{width:70vw}#bc-root.middle .bc-topnav .bc-format{display:initial}#bc-root.middle .bc-video-container{width:70vw;height:80vh;position:relative}#bc-root.middle .bc-video-container .active video{max-width:70vw;max-height:80vh}#bc-root.middle .bc-video-container .minified{position:absolute}#bc-root.middle .bc-controls{max-width:70vw;bottom:10vh;padding:2% 0}}#bc-root.middle #bc-format i::before{content:""}#bc-root.minified{position:fixed;width:auto;height:auto;top:initial;right:initial;bottom:20px;left:20px;border:1px solid rgba(0,0,0,0);border-radius:30px;overflow:hidden;cursor:pointer}#bc-root.minified .bc-topnav{opacity:0}#bc-root.minified .bc-topnav .bc-call-info{max-width:100%}#bc-root.minified .bc-topnav .options{display:none}#bc-root.minified .bc-video-container{width:auto;height:auto;max-height:initial !important;padding-bottom:0;transition:all .3s ease}#bc-root.minified .bc-video-container.vertical{max-width:250px}#bc-root.minified .bc-video-container.vertical .active{max-width:250px}#bc-root.minified .bc-video.minified{display:none}#bc-root.minified .bc-video.active{transition:all .3s ease;height:100%;max-width:350px}#bc-root.minified .bc-video.active.novid{max-height:250px;padding:1em;max-width:250px;max-height:250px}#bc-root.minified .bc-video.active video{width:auto}@media screen and (max-width: 768px){#bc-root.minified .bc-video .name{display:none}}#bc-root.minified .bc-video-btn{display:none}#bc-root.minified .bc-controls{position:absolute;bottom:0;min-width:initial !important;justify-content:space-between;opacity:0;transition:opacity .3s ease}@media screen and (max-width: 1025px){#bc-root.minified .bc-controls{display:none !important}}#bc-root.minified .bc-controls .bc-btn{width:4vw;height:4vw;max-width:55px;max-height:55px;font-size:.8rem;margin:0}#bc-root.minified .bc-controls .bc-btn.bc-camera,#bc-root.minified .bc-controls .bc-btn.bc-decline,#bc-root.minified .bc-controls .bc-btn.bc-hide{display:none}#bc-root.minified .bc-controls .bc-btn#bc-expand{display:flex}#bc-root.minified:hover .bc-controls,#bc-root.minified:hover .bc-topnav{display:flex;opacity:1}@media screen and (max-width: 1025px){#bc-root.minified{top:65px !important;right:10px !important;left:initial !important;bottom:initial !important;border-radius:15px;overflow:hidden}#bc-root.minified .bc-video-container{max-width:250px}#bc-root.minified .bc-video-container.vertical{max-width:25vw}#bc-root.minified .bc-topnav{display:none !important}}.bc{-webkit-tap-highlight-color:rgba(0,0,0,0) !important}.bc-container{font-family:"Segoe UI Variable","Segoe UI",SegoeUI,"Helvetica Neue",Helvetica,Arial,sans-serif;display:flex;flex-wrap:wrap;justify-content:space-evenly;align-items:center}.bc-container>div{z-index:333333}.bc-notify{z-index:4444444 !important;position:fixed;top:28px}.bc-incoming-call{z-index:33333;padding:10px;width:494px;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;background:radial-gradient(87.44% 183.75% at 50% 50%, rgba(0, 0, 0, 0) 0%, #000000 100%),#242f3d;box-shadow:0px 4px 20px rgba(0,0,0,.5);border-radius:12px}@media screen and (max-width: 576px){.bc-incoming-call{padding:16px;width:90vw}}.bc-incoming-call .user{display:flex;justify-content:space-between;max-width:50%}@media screen and (max-width: 576px){.bc-incoming-call .user{max-width:70%;margin-bottom:16px}}.bc-incoming-call .user .title{text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;line-height:20px;color:rgb(var(--color-cc-white))}.bc-incoming-call .user .title .name{font-size:16px;text-align:left;color:rgb(var(--text-on-bg-ac-color));width:200px;overflow:hidden;text-overflow:ellipsis}.bc-incoming-call .user .title .description{color:rgb(var(--neutral-grad-2));font-size:14px;text-align:left}.bc-incoming-call .user .avatar{margin-right:16px;border:2px solid rgba(0,0,0,0);width:44px;height:44px;border-radius:50%;overflow:hidden;display:flex;justify-content:center;align-items:center;font-size:1.4em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-incoming-call .user .avatar img{height:100%;width:100%}.bc-incoming-call .buttons{display:flex;justify-content:space-between}@media screen and (max-width: 576px){.bc-incoming-call .buttons{width:100%;justify-content:space-between}.bc-incoming-call .buttons .bc-btn{width:48% !important;margin:0}}.bc-incoming-call .buttons .bc-btn{width:56px;height:48px;border-radius:12px;margin:0 10px;border:none;cursor:pointer}.bc-incoming-call .buttons .bc-answer{background:linear-gradient(90deg, #495AFF 0%, #0ACFFE 100%),#00a4ff}.bc-incoming-call .buttons .bc-answer i{transform:rotate(90deg)}.bc-incoming-call .buttons .bc-decline{background:linear-gradient(90deg, #EB3349 2.65%, #F45C43 100.53%),#eb5757}.bc-incoming-call .buttons .bc-decline i{transform:rotate(225deg)}.bc-incoming-call .buttons i{color:rgb(var(--text-on-bg-ac-color))}.bc-ended-call{width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;background:radial-gradient(87.44% 183.75% at 50% 50%, rgba(0, 0, 0, 0) 0%, #000000 100%),#242f3d;color:rgb(var(--text-on-bg-ac-color))}.bc-ended-call .avatar{display:flex;border:2px solid rgba(var(--background-hidden-layer, 0.1));width:160px;height:160px;border-radius:50%;overflow:hidden;justify-content:center;align-items:center;font-size:1.6em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-ended-call .avatar img{width:100%;height:100%}.bc-ended-call .name{font-size:28px;font-weight:600;margin-top:42px;width:400px;text-align:center;max-width:90vw;overflow:hidden;text-overflow:ellipsis}.bc-ended-call .description{color:#838383;font-size:16px;line-height:24px;margin-top:4px}.bc-ended-call button{cursor:pointer}.bc-video{position:relative;display:flex;justify-content:center}@media screen and (orientation: portrait){.bc-video{max-width:100%}}.bc-video-container{display:flex;justify-content:center;flex-wrap:wrap;align-items:center;width:100vw;height:100vh;background:radial-gradient(55.29% 79.17% at 50% 47.76%, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.88) 100%),#242f3d;box-shadow:0px 32px 64px rgba(0,0,0,.56),0px 2px 21px rgba(0,0,0,.55)}@media screen and (orientation: portrait){.bc-video{justify-content:center}}.bc-video .name{position:absolute;bottom:0;left:0;text-align:center;font-size:12px;height:12px;line-height:12px;min-width:60px;background-color:rgba(255,255,255,.4)}.bc-video video{max-height:100%;width:100%}@media screen and (orientation: portrait){.bc-video video{max-height:40vh}}.bc-video.active{width:100%;margin:0 auto;height:100vh;max-height:100vh}.bc-video.active .avatar{border:2px solid rgba(var(--background-hidden-layer, 0.1));width:160px;height:160px;border-radius:50%;overflow:hidden;display:none;justify-content:center;align-items:center;font-size:1.6em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-video.active .avatar img{width:100%;height:100%}.bc-video.active video{max-height:100vh;max-width:100vw;width:auto !important}.bc-video.active.novid{max-height:100%;align-items:center}.bc-video.active.novid .avatar{display:flex}.bc-video.active.novid video{display:none}.bc-video.minified{margin:0;border-radius:10%;z-index:33333333;position:fixed;right:30px;bottom:15%;max-width:15vw;overflow:hidden}.bc-video.minified video{transform:scale(-1, 1);height:15vw;width:auto}@media screen and (orientation: portrait){.bc-video.minified{max-width:15vh}.bc-video.minified video{height:15vh;width:auto}}.bc-controls{display:flex;justify-content:center;position:fixed;background:linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.99466) 99.44%);bottom:0;width:100%;padding:5%;min-width:280px !important;max-width:100vw}.bc-controls .bc-btn{margin:0 20px;background:rgba(var(--neutral-grad-2), 0.4);text-align:center;font-size:1em;font-weight:600;border-radius:50%;width:55px;height:55px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:none}.bc-controls .bc-btn.active{background:rgb(var(--text-on-bg-ac-color))}.bc-controls .bc-btn.active i{color:rgb(var(--text-color))}@media screen and (max-width: 768px){.bc-controls .bc-btn{margin:0 10px;width:45px;height:45px}}.bc-controls .bc-btn i{pointer-events:none;color:rgb(var(--text-on-bg-ac-color))}.bc-controls .bc-btn.bc-decline{background:rgb(var(--color-bad));border:1px solid rgba(0,0,0,0);transform:rotate(225deg)}.bc-controls .bc-btn#bc-expand{display:none}.bc-topnav{z-index:4444444 !important;display:flex;justify-content:space-between;align-items:center;position:absolute;top:0;right:0;left:0;color:rgb(var(--text-on-bg-ac-color));background:linear-gradient(180deg, rgba(0, 0, 0, 0.799466) 0%, rgba(0, 0, 0, 0) 99.44%);padding:26px 28px;width:100vw}.bc-topnav .options button{background:rgba(0,0,0,0);border:none;cursor:pointer}.bc-topnav .options button i{color:rgb(var(--text-on-bg-ac-color))}.bc-call-info{display:flex;flex-direction:column}.bc-call-info .name{width:200px;overflow:hidden;text-overflow:ellipsis;transition:width .3s ease}@media(pointer: fine){.bc-call-info .name:hover{width:400px}}',""]);const s=a},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",n=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),n&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),n&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,n,o,r){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(n)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var l=0;l<t.length;l++){var d=[].concat(t[l]);n&&a[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),i&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=i):d[2]=i),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),e.push(d))}},e}},81:t=>{t.exports=function(t){return t[1]}},187:t=>{var e,i="object"==typeof Reflect?Reflect:null,n=i&&"function"==typeof i.apply?i.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};e=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function r(){r.init.call(this)}t.exports=r,t.exports.once=function(t,e){return new Promise((function(i,n){function o(i){t.removeListener(e,r),n(i)}function r(){"function"==typeof t.removeListener&&t.removeListener("error",o),i([].slice.call(arguments))}u(t,e,r,{once:!0}),"error"!==e&&function(t,e,i){"function"==typeof t.on&&u(t,"error",e,{once:!0})}(t,o)}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var a=10;function s(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function c(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function l(t,e,i,n){var o,r,a,l;if(s(i),void 0===(r=t._events)?(r=t._events=Object.create(null),t._eventsCount=0):(void 0!==r.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),r=t._events),a=r[e]),void 0===a)a=r[e]=i,++t._eventsCount;else if("function"==typeof a?a=r[e]=n?[i,a]:[a,i]:n?a.unshift(i):a.push(i),(o=c(t))>0&&a.length>o&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=t,d.type=e,d.count=a.length,l=d,console&&console.warn&&console.warn(l)}return t}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},o=d.bind(n);return o.listener=i,n.wrapFn=o,o}function v(t,e,i){var n=t._events;if(void 0===n)return[];var o=n[e];return void 0===o?[]:"function"==typeof o?i?[o.listener||o]:[o]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(o):m(o,o.length)}function p(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function m(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}function u(t,e,i,n){if("function"==typeof t.on)n.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function o(r){n.once&&t.removeEventListener(e,o),i(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");a=t}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var o="error"===t,r=this._events;if(void 0!==r)o=o&&void 0===r.error;else if(!o)return!1;if(o){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=r[t];if(void 0===c)return!1;if("function"==typeof c)n(c,this,e);else{var l=c.length,d=m(c,l);for(i=0;i<l;++i)n(d[i],this,e)}return!0},r.prototype.addListener=function(t,e){return l(this,t,e,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(t,e){return l(this,t,e,!0)},r.prototype.once=function(t,e){return s(e),this.on(t,h(this,t,e)),this},r.prototype.prependOnceListener=function(t,e){return s(e),this.prependListener(t,h(this,t,e)),this},r.prototype.removeListener=function(t,e){var i,n,o,r,a;if(s(e),void 0===(n=this._events))return this;if(void 0===(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(o=-1,r=i.length-1;r>=0;r--)if(i[r]===e||i[r].listener===e){a=i[r].listener,o=r;break}if(o<0)return this;0===o?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,o),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,a||e)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(t){var e,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var o,r=Object.keys(i);for(n=0;n<r.length;++n)"removeListener"!==(o=r[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},r.prototype.listeners=function(t){return v(this,t,!0)},r.prototype.rawListeners=function(t){return v(this,t,!1)},r.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},r.prototype.listenerCount=p,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},379:t=>{var e=[];function i(t){for(var i=-1,n=0;n<e.length;n++)if(e[n].identifier===t){i=n;break}return i}function n(t,n){for(var r={},a=[],s=0;s<t.length;s++){var c=t[s],l=n.base?c[0]+n.base:c[0],d=r[l]||0,h="".concat(l," ").concat(d);r[l]=d+1;var v=i(h),p={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==v)e[v].references++,e[v].updater(p);else{var m=o(p,n);n.byIndex=s,e.splice(s,0,{identifier:h,updater:m,references:1})}a.push(h)}return a}function o(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,o){var r=n(t=t||[],o=o||{});return function(t){t=t||[];for(var a=0;a<r.length;a++){var s=i(r[a]);e[s].references--}for(var c=n(t,o),l=0;l<r.length;l++){var d=i(r[l]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}r=c}}},569:t=>{var e={};t.exports=function(t,i){var n=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,i)=>{t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var n="";i.supports&&(n+="@supports (".concat(i.supports,") {")),i.media&&(n+="@media ".concat(i.media," {"));var o=void 0!==i.layer;o&&(n+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),n+=i.css,o&&(n+="}"),i.media&&(n+="}"),i.supports&&(n+="}");var r=i.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={id:n,exports:{}};return t[n](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nc=void 0;var n={};return(()=>{i.r(n),i.d(n,{default:()=>g});var t=i(187),e=i(379),o=i.n(e),r=i(795),a=i.n(r),s=i(569),c=i.n(s),l=i(565),d=i.n(l),h=i(216),v=i.n(h),p=i(589),m=i.n(p),u=i(326),f={};f.styleTagTransform=m(),f.setAttributes=d(),f.insert=c().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=v(),o()(u.Z,f),u.Z&&u.Z.locals&&u.Z.locals;class b extends t.EventEmitter{constructor(t,e,i,n){super(),this.client=t,this.matrixcs=e,this.initEvents(),this.initSignals(),this.initTemplates(i),this.options=n}controls={};isFrontalCamera=!1;videoStreams=null;isMuted=!1;activeCall=null;secondCall=null;syncInterval=null;isWaitingForConnect=!1;signal=null;templates={incomingCall:function(){return`\n\t\t\t<div class="bc-incoming-call">\n\t\t\t\t<div class="user">\n\t\t\t\t\t<div class="avatar">\n\t\t\t\t\t\t${this.getAvatar()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="title">\n\t\t\t\t\t\t<div class="name">${this.activeCall.initiator.source.name}</div>\n\t\t\t\t\t\t<div class="description">Входящий звонок</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="buttons">\n\t\t\t\t\t<button class="bc-btn bc-decline" id="bc-decline"><i class="fas fa-phone"></i></button>\n\t\t\t\t\t<button class="bc-btn bc-answer" id="bc-answer"><i class="fas fa-phone"></i></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`},endedCall:function(t){return`\t\n\t\t\t<div class="bc-ended-call">\n\t\t\t\t<div class="avatar">\n\t\t\t\t\t\t${this.getAvatar()}\n\t\t\t\t</div>\n\t\t\t\t<div class="name">${this.activeCall.initiator.source.name}</div>\n\t\t\t\t<div class="description">Звонок завершен</div>\n\t\t\t</div>`},videoCall:function(){return`\n\t\t\t<div class="bc-topnav">\n\t\t\t\t<div class="bc-call-info">\n\t\t\t\t\t<div class="time" id="time">12:02</div>\n\t\t\t\t\t<div class="name">${this.activeCall.initiator.source.name}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="options">\n\t\t\t\t\t<button class="bc-btn bc-cog" id="bc-cog"><i class="fas fa-cog"></i></button>\n\t\t\t\t\t<button class="bc-btn bc-pip" id="bc-pip"><i class="fas fa-images"></i></button>\n\t\t\t\t\t<button class="bc-btn bc-format" id="bc-format"><i class="fas"></i></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bc-video-container">\n\t\t\t\t<div class="bc-video active novid" id="remote-scene">\n\t\t\t\t\t<video id="remote" pip="false" autoplay playsinline ></video>\n\t\t\t\t\t<div class="avatar">${this.getAvatar()}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bc-video minified">\n\t\t\t\t\t<video id="local" pip="false" autoplay playsinline ></video>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bc-controls">\n\t\t\t\t<button class="bc-btn bc-camera" id="bc-camera"><i class="fas fa-sync-alt"></i></button>\n\t\t\t\t<button class="bc-btn bc-hide" id="bc-hide"><i class="fas fa-video"></i></button>\n\t\t\t\t<button class="bc-btn bc-mute" id="bc-mute"><i class="fas fa-microphone"></i></button>\n\t\t\t\t<button class="bc-btn bc-decline" id="bc-decline"><i class="fas fa-phone"></i></button>\n\t\t\t\t<button class="bc-btn bc-expand" id="bc-expand"><i class="fas fa-expand"></i></button>\n\t\t\t</div>\n\t\t`}};renderTemplates={videoCall:()=>{console.log("videoCall"),this.root.classList.add("middle"),this.root.innerHTML=this.templates.videoCall?.call(this)||"",this.initCallInterface("videoCall")},incomingCall:t=>{this.notify.innerHTML=this.templates.incomingCall?.call(this)||"",this.initCallInterface("incomingCall",t)},clearNotify:()=>{console.log("clearNotify"),this.notify.innerHTML=""},clearVideo:()=>{console.log("clearVideo"),this.root.innerHTML=""},clearInterface:()=>{console.log("clearInterface"),this.root.classList.remove("active"),this.root.classList.remove("minified"),this.root.classList.remove("middle"),this.root.classList.remove("full")},endedCall:t=>{this.root.classList.contains("minified")&&(this.root.classList.remove("minified"),this.root.classList.add("middle")),this.root.innerHTML=this.templates.endedCall?.call(this,t)||""}};initTemplates(t){console.log(t),t.insertAdjacentHTML("beforeend",'<div class="bc-container"><div id="bc-notify" class="bc-notify"></div><div id="bc-root"></div></div>'),this.root=document.getElementById("bc-root"),this.notify=document.getElementById("bc-notify"),window&&(console.log("проверка закрывашки"),window.onunload=()=>{this.activeCall&&this.activeCall.hangup()})}initEvents(){this.client.on("Call.incoming",(async t=>{let e=this.client.store.rooms[t.roomId].currentState.members,i=e[Object.keys(e).filter((t=>t!==this.client.credentials.userId))],n=e[this.client.credentials.userId];t.initiator=i,t.user=n,this.options.getUserInfo(i.userId).then((e=>{i.source=e[0]||e,this.addCallListeners(t),this.activeCall?this.secondCall?t.reject("занято"):(this.secondCall=t,console.log("новый звонок в очереди",t)):this.activeCall=t;let n=new Audio("js/lib");n.autoplay=!0,n.loop=!0,this.signal=n,this.renderTemplates.incomingCall(t),this.signal.src="sounds/incoming.mp3",console.log(this.signal)}))}))}initSignals(){this.signal=new Audio}answer(){try{"ringing"===this.activeCall.state?(this.activeCall.answer(),console.log("Ответ на",this.activeCall),this.signal.pause(),this.renderTemplates.clearNotify(),this.renderTemplates.videoCall()):(this.isWaitingForConnect=!0,this.renderTemplates.clearNotify(),this.activeCall.hangup(),setTimeout((()=>{try{console.log("Сброс + ответ на",this.activeCall),this.activeCall.answer(),this.signal.pause(),this.isWaitingForConnect=!1,this.renderTemplates.videoCall()}catch(t){console.log("Ошибка при ответе на вторую линию",t),this.signal.pause()}}),1e3))}catch(t){console.log("error answer",t),this.signal.pause()}}initsync(){let t=document.querySelector(".bc-video-container");this.activeCall.peerConn.getStats(null).then((t=>{[...t].filter((t=>"candidate-pair"===t[1].type)).forEach((e=>{console.log(t.get(e.selectedCandidatePairId))}))})),this.syncInterval=setInterval(function(){if(this?.activeCall?.remoteStream){let e=this?.activeCall?.remoteStream.getVideoTracks()[0];if(this.root.classList.contains("minified")){let i=e.getSettings().aspectRatio;i&&(t.style.aspectRatio=i,i<1?t.classList.add("vertical"):t.classList.remove("vertical"))}}}.bind(this),1e3)}mute(t){t.stopPropagation();let e=this.activeCall.peerConn.getSenders().find((t=>"audio"===t.track.kind)),i=document.querySelector(".bc-mute");e.track.enabled?(i.firstChild.classList.remove("fa-microphone"),i.classList.add("active"),i.firstChild.classList.add("fa-microphone-slash")):(i.firstChild.classList.remove("fa-microphone-slash"),i.classList.remove("active"),i.firstChild.classList.add("fa-microphone")),e.track.enabled=!e.track.enabled,console.log("mute",this.activeCall.peerConn.getSenders())}hide(t){t.stopPropagation();let e=this.activeCall.peerConn.getSenders().find((t=>"video"===t.track?.kind||!t.track)),i=document.querySelector(".bc-hide");e.track.enabled?(i.firstChild.classList.remove("fa-video"),i.classList.add("active"),i.firstChild.classList.add("fa-video-slash")):(i.firstChild.classList.remove("fa-video-slash"),i.classList.remove("active"),i.firstChild.classList.add("fa-video")),e.track.enabled=!e.track.enabled,console.log("hide",this.activeCall.peerConn.getSenders(),this.activeCall.peerConn.getReceivers()),console.log("remote tracks",this.activeCall.remoteStream.getTracks())}cameraCount(){navigator.mediaDevices.enumerateDevices().then((t=>{let e=t.filter((t=>"videoinput"===t.kind));console.log(e),e.length<=1&&(document.getElementById("bc-camera").style.display="none",console.log("no cameras"))}))}camera(t){let e=this;try{navigator.mediaDevices.enumerateDevices().then((t=>{let i,n=t.filter((t=>"videoinput"===t.kind));const o=e.activeCall.peerConn.getSenders();console.log("senders",o);let r=o.find((t=>"video"==t.track.kind));if(console.log("sender",r),r&&r?.label?.includes("front")&&(console.log("Используется фронтальная камера"),e.isFrontalCamera=!0),console.log("список видео",n),!(n.length>1))return;r.track.label.includes("front")||r.track.label.includes("передней")?(console.log("на заднюю"),i=n.reverse().find((t=>t.label.includes("back")||t.label.includes("задней")))):(console.log("на переднюю"),i=n.find((t=>t.label.includes("front")||t.label.includes("передней")))),console.log("fft",i);let a={};a.deviceId={exact:i.deviceId};const s={video:a,audio:!1};navigator.mediaDevices.getUserMedia(s).then((t=>{t.getTracks().forEach((function(i){console.log("track",i);const n=e.activeCall.peerConn.getSenders().find((t=>t.track.kind==i.kind));console.log("текущий видеострим ",n),n.track.label!==i.label?(i.muted&&console.log("Трек не доступен",i),n.replaceTrack(i),e.videoStreams.local.srcObject=t):console.log("одинаковый стрим")})),this.hide()})).catch((function(t){console.log("Const stream: "+t.message)}))})).catch((function(t){console.log("Check: "+t.message)}))}catch(t){console.log("sa",t)}}format(){this.root.classList.contains("middle")?(this.root.classList.remove("middle"),this.root.classList.add("full")):this.root.classList.contains("full")&&(this.root.classList.remove("full"),this.root.classList.add("middle"))}pip(){this.root.classList.contains("middle")?(this.root.classList.remove("middle"),this.root.classList.add("minified")):this.root.classList.contains("full")?(this.root.classList.remove("full"),this.root.classList.add("minified")):(clearInterval(this.syncInterval),console.log("interval",this.syncInterval),this.root.classList.remove("minified"),this.root.classList.add("middle"))}async initCall(t){if(console.log("init calle"),this.activeCall&&this?.activeCall?.roomId===t)return void console.log("Call is already init",this);const e=matrixcs.createNewMatrixCall(this.client,t);if(e.placeVideoCall(document.getElementById("remote"),document.getElementById("local")).then(async function(){console.log("after place",this);let t=this.client.store.rooms[e.roomId].currentState.members,i=t[Object.keys(t).filter((t=>t!==this.client.credentials.userId))],n=t[this.client.credentials.userId];e.initiator=i,e.user=n,i.source=await this.options.getUserInfo(i.userId)[0],this.options.getUserInfo(i.userId).then((t=>{console.log(t),i.source=t[0]||t,this.signal.src="sounds/calling.mp3",console.log(this.signal),this.renderTemplates.videoCall()})).catch((t=>console.log("get user info error",t)))}.bind(this)),this.addCallListeners(e),this.activeCall)return void console.log("You have active call");this.activeCall=e;let i=new Audio("js/lib");return i.autoplay=!0,i.loop=!0,this.signal=i,e}hexDecode(t){for(var e=0,i="",n=2;n<=t.length;n+=2)(e=parseInt(t.substring(n-2,n),16))>=128&&(e+=848),i+=e=String.fromCharCode("0x"+e.toString(16));return i}hangup(t){t.stopPropagation(),this.activeCall.hangup("ended",!1),this.renderTemplates.clearVideo(),console.log("hangup"),this.signal.pause()}reject(t){t.reject(),this.signal.pause()}initCallInterface(t,e){switch(t){case"incomingCall":document.getElementById("bc-answer").addEventListener("click",this.answer.bind(this)),document.getElementById("bc-decline").addEventListener("click",(()=>this.reject(e)));break;case"videoCall":this.videoStreams={remote:document.getElementById("remote"),local:document.getElementById("local")};try{console.log("init call interface",this.activeCall),this.activeCall.setLocalVideoElement(this.videoStreams.local),this.activeCall.setRemoteVideoElement(this.videoStreams.remote),this.cameraCount(),this.addVideoInterfaceListeners(),console.log("стримы",this.videoStreams)}catch(t){console.log("init interface error",t)}}}addVideoInterfaceListeners(){document.getElementById("remote-scene").addEventListener("click",(t=>this.pip.call(this,t))),document.getElementById("bc-decline").addEventListener("click",(t=>this.hangup.call(this,t))),document.getElementById("bc-mute").addEventListener("click",(t=>this.mute.call(this,t))),document.getElementById("bc-hide").addEventListener("click",(t=>this.hide.call(this,t))),document.getElementById("bc-camera").addEventListener("click",(t=>this.camera.call(this,t))),document.getElementById("bc-expand").addEventListener("click",(t=>this.pip.call(this,t))),document.getElementById("bc-cog").addEventListener("click",(t=>this.settings.call(this,t))),document.getElementById("bc-format").addEventListener("click",(t=>this.format.call(this,t))),document.getElementById("bc-pip").addEventListener("click",(t=>this.pip.call(this,t)))}addCallListeners(t){t.on("state",((t,e)=>{console.log("state",t),"connected"===t&&(this.showRemoteVideo(),this.signal.pause(),console.log("connected",this.activeCall),this.initsync()),"ended"===t&&(clearInterval(this.syncInterval),console.log("interval",this.syncInterval),this.signal.pause())})),t.on("hangup",(t=>{if(clearInterval(this.syncInterval),this.syncInterval=null,console.log("interval",this.syncInterval),console.log("Call ended",t),console.log("status",this),t||this.renderTemplates.clearNotify(),t.callId===this.secondCall?.callId&&(this.secondCall=null,this.renderTemplates.clearNotify(),console.log("second line ended",t)),t.callId===this.activeCall?.callId){if(console.log("first line ended",this),this.isWaitingForConnect)return this.activeCall=this.secondCall,this.secondCall=null,void console.log("вторая линия стала первой",this.activeCall);if(this.renderTemplates.clearVideo(),this.renderTemplates.clearNotify(),"local"===t.hangupParty||t.localVideoElement)return this.root.classList.contains("minified")||!this.root.classList.length?(this.renderTemplates.clearVideo(),this.renderTemplates.clearInterface(),void(this.activeCall=null)):(this.renderTemplates.endedCall(t),(t.hangupReason=!t.remoteStream&&"local"!==t.hangupParty)&&(console.log("Занят",this.signal),this.signal.loop=!1,this.signal.src="sounds/busy.mp3"),void setTimeout((()=>{this.renderTemplates.clearVideo(),this.renderTemplates.clearInterface(),this.activeCall=null,console.log(this.activeCall)}),3e3));this.signal.pause(),this.renderTemplates.clearInterface()}})),t.on("error",(e=>{console.log("s",this),console.log("some error",e),this.lastError=e.message,t.hangup("error"),this.signal.pause(),this.renderTemplates.clearVideo(),this.emit("error",e)}))}getAvatar(){return this.activeCall.initiator?.source?.image?`<img src="${this.activeCall.initiator.source.image}"/>`:this.activeCall.initiator.source.name[0].toUpperCase()}showRemoteVideo(){document.getElementById("remote-scene").classList.remove("novid")}}window.BastyonCalls=b;const g=b})(),n})()));